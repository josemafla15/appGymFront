<div class="dashboard">
  <h1>My Dashboard</h1>

  <app-loading-spinner *ngIf="loading"></app-loading-spinner>

  <app-alert *ngIf="error" type="warning" [message]="error"></app-alert>

  <div *ngIf="!loading && !error" class="dashboard-content">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon workouts">
            <mat-icon>fitness_center</mat-icon>
          </div>
          <h3>Total Workouts</h3>
          <p class="stat-value">{{ stats?.total_workouts || 0 }}</p>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon completed">
            <mat-icon>check_circle</mat-icon>
          </div>
          <h3>Completed</h3>
          <p class="stat-value">{{ stats?.completed_workouts || 0 }}</p>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon rate">
            <mat-icon>trending_up</mat-icon>
          </div>
          <h3>Completion Rate</h3>
          <p class="stat-value">{{ stats?.completion_rate || 0 | number:'1.0-1' }}%</p>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon sets">
            <mat-icon>repeat</mat-icon>
          </div>
          <h3>Total Sets</h3>
          <p class="stat-value">{{ stats?.total_sets || 0 }}</p>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Current Program -->
    <mat-card *ngIf="assignment && weekInfo" class="program-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>calendar_today</mat-icon>
          Current Week
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <h2>{{ assignment.week_template.name }}</h2>
        <p class="description">{{ assignment.week_template.description }}</p>
        
        <!-- Week Progress -->
        <div class="week-progress">
          <div class="progress-header">
            <span>This Week's Progress</span>
            <span class="progress-percentage">{{ getWeekProgress() }}%</span>
          </div>
          <mat-progress-bar 
            mode="determinate" 
            [value]="getWeekProgress()"
            [color]="getProgressColor()">
          </mat-progress-bar>
          <div class="progress-info">
            <span>{{ weekInfo.completed_workouts }} of {{ weekInfo.total_days }} workouts completed</span>
          </div>
        </div>

        <!-- Week Dates -->
        <div class="program-meta">
          <div class="meta-item">
            <mat-icon>event</mat-icon>
            <span>{{ weekInfo.start_date | date:'mediumDate' }} - {{ weekInfo.end_date | date:'mediumDate' }}</span>
          </div>
          <div class="meta-item">
            <mat-icon>view_week</mat-icon>
            <span>Day {{ weekInfo.days_elapsed }} of 7</span>
          </div>
          <div class="meta-item" *ngIf="!weekInfo.is_current_week">
            <mat-icon>warning</mat-icon>
            <span class="warning-text">This week has ended</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button mat-raised-button color="primary" routerLink="/user/workouts">
            <mat-icon>play_arrow</mat-icon>
            Start Workout
          </button>
          <button mat-stroked-button routerLink="/user/progress">
            <mat-icon>assessment</mat-icon>
            View Progress
          </button>
          <button 
            *ngIf="weekInfo.can_renew" 
            mat-raised-button 
            color="accent"
            (click)="onRenewWeek()">
            <mat-icon>autorenew</mat-icon>
            Start New Week
          </button>
        </div>

        <!-- Renew Message -->
        <mat-card *ngIf="weekInfo.can_renew && !weekInfo.is_current_week" class="renew-message">
          <mat-card-content>
            <div class="renew-content">
              <mat-icon>info</mat-icon>
              <div>
                <h4>Ready for a new week?</h4>
                <p>Your current week has ended. Click "Start New Week" to continue with the same program.</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </mat-card-content>
    </mat-card>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2>Quick Actions</h2>
      <div class="actions-grid">
        <button mat-raised-button color="accent" routerLink="/user/workouts">
          <mat-icon>fitness_center</mat-icon>
          <span>My Workouts</span>
        </button>
        <button mat-raised-button routerLink="/user/history">
          <mat-icon>history</mat-icon>
          <span>Workout History</span>
        </button>
        <button mat-raised-button routerLink="/user/progress">
          <mat-icon>show_chart</mat-icon>
          <span>Progress</span>
        </button>
      </div>
    </div>
  </div>
</div>